- name: Download gtk theme (github)
  github-release-download:
    project: '{{ settings.gnome.gtk_theme.github }}'
    tag: '{{ settings.gnome.gtk_theme.version }}'
    match_asset: '^.*\.tar.xz$'
    dest: /tmp
  when: >
    (not settings.gnome.gtk_theme.name + " " + settings.gnome.gtk_theme.version in check_versions.stdout) and
    (settings.gnome.gtk_theme.github is defined)
  register: download_theme

- name: Install gtk theme
  ansible.builtin.unarchive:
    src: '{{ download_theme.dest }}'
    dest: ~/.local/share/themes
  when: not download_theme is skipped

- name: Write version to file
  ansible.builtin.lineinfile:
    path: ~/.ansible_versions
    line: '{{ settings.gnome.gtk_theme.name }} {{ settings.gnome.gtk_theme.version }}'
    regexp: '^{{ settings.gnome.gtk_theme.name }}'
    create: true
    mode: 0644
  when: not download_theme is skipped

- name: Set gtk theme
  community.general.dconf:
    key: '/org/gnome/desktop/interface/gtk-theme'
    value: "'{{ settings.gnome.gtk_theme.name }}'"
    state: present
